{# Assumes a context object named 'object' which is a LockableModel instance #}

{% load humanize object_lock %}

    <div class='d-flex justify-content-between align-items-center mb-2'>
        <div class='mr-3'>
            <small class='text-muted'>
                {% if object.is_locked %}

                    {% if object.locked_by == request.user %}
                        {% with lockrequests=lock.objectlockrequest_set.all %}
                            {% if lockrequests.first %}
                                {% with more=lockrequests|slice:'1:' %}
                                    <i class='fa fa-info-circle' title='Lock requested by {{ lockrequests.first.from_user }} {% if more.count > 0 %}+{{ more.count }} other{{ more.count|pluralize }}{% endif %}'></i>
                                {% endwith %}
                            {% endif %}       
                        {% endwith %}                                
                    {% endif %}

                    <i class='fa fa-lock'></i>
                    Locked for editing by
                    <b>
                    {% if object.locked_by == request.user %} you {% else %} {{ object.locked_by }} {% endif %}
                    </b>
                {% else %}
                    Available for editing 
                {% endif %}
                </small>
        </div>
        <div>
            <form novalidate enctype="multipart/form-data" autocomplete='off' action='{{ request.path }}' class="form"
                method='POST'>
                {% csrf_token %}
                {% if object.locked_by == request.user %}
                    <button type='submit' class='btn btn-primary btn-sm' name='unlock'>Finish&nbsp;Editing</button>
                {% elif object.is_locked %}
                    <button type='submit' class='btn btn-warning btn-sm' name='request'>Request Lock</button>
                {% elif not object.is_locked %}
                    <button type='submit' class='btn btn-primary btn-sm' name='lock'>Edit</button>
                {% endif %}
            </form>
        </div>
    </div>
    {% with user_lock_request=request.user|lock_request:object %}
    {% if user_lock_request %}<small class='text-muted'>You requested this item on {{ user_lock_request.created }}</small>{% endif %}
    {% endwith %}


{% comment %}
{% if object.is_locked %}

        Locked for editing by
        {% if object.locked_by == request.user %} you {% else %} {{ object.locked_by }} {% endif %}
        <small>
            <br>since {{ object.locked_at }}
        </small>

        {% if object.locked_by == request.user %}
        <form novalidate enctype="multipart/form-data" autocomplete='off' action='{{ request.path }}' class="form"
            method='POST'>
            {% csrf_token %}
            <button type='submit' class='btn btn-light btn-sm' name='unlock'>Finish Editing</button>
        </form>
        {% endif %}

{% elif not object.is_locked %}
        Unlocked
        <form novalidate enctype="multipart/form-data" autocomplete='off' action='{{ request.path }}' class="form"
            method='POST'>
            {% csrf_token %}
            <button type='submit' class='btn btn-light btn-sm' name='lock'>Edit</button>
        </form>

{% endif %}
{% endcomment %}