{# Assumes context objects named link object named 'link' also 'can_edit' and 'has_object_lock' and 'what' which is fragment or testimonium #}

{% load i18n %}
    {% with work=link.work linked_field=link.linked_field %}
    <div class='rard-list-item d-flex justify-content-between' id="link-{{link.pk}}">
        <div>
            <li class="unstyled">
                <span class="definite-indicators">
                    {% if link.definite_antiquarian %}
                        <i title='Definite antiquarian link' data-placement="top" data-toggle='tooltip' class='fa fa-solid fa-user fa-xs text-success'></i>
                    {% else %}
                        <i title='Possible antiquarian link' data-placement="top" data-toggle='tooltip' class='fa fa-user fa-xs text-muted'></i>
                    {% endif %}
                    {% if link.definite_work %}
                        <i title='Definite work link' data-placement="top" data-toggle='tooltip' class='fa fa-solid fa-book fa-xs text-success'></i>
                    {% else %}
                        <i title='Possible work link' data-placement="top" data-toggle='tooltip' class='fa fa-solid fa-book fa-xs text-muted'></i>
                    {% endif %}

                    {% if link.definite_book %}
                        <i title='Definite book link' data-placement="top" data-toggle='tooltip' class='fa fa-solid fa-bookmark fa-xs text-success'></i>
                    {% else %}
                        <i title='Possible book link' data-placement="top" data-toggle='tooltip' class='fa fa-solid fa-bookmark fa-xs text-muted'></i>
                    {% endif %}
                </span>
                <a href='{% url "work:detail" work.pk %}'>{{ work.name }}</a>
                {% if link.book %}
                    {{ link.book }}

                    {% if link.book.display_date_range %}
                        <span class='text-muted date-range-element'><small>[{{ link.book.display_date_range }}]</small></span>
                    {% endif %}

                {% else %}
                    {% if work.display_date_range %}
                        <span class='text-muted date-range-element'><small>[{{ work.display_date_range }}]</small></span>
                    {% endif %}

                {% endif %}
                {% include 'research/partials/render_inline_lock_icon.html' with object=work %}

            </li>
        </div>
        <div class='rard-list-item-actions' >
        {% if can_edit and has_object_lock %}
        {% if linked_field == 'fragment' %}
        <form novalidate class='form-inline' action='{% url "fragment:update_fragment_link" link.pk %}' method='POST'>
            {% else %}
            <form novalidate class='form-inline' action='{% url "testimonium:update_testimonium_link" link.pk %}' method='POST'>
            {% endif %}
        {% csrf_token %}
        <div class='form-group'>
            <button type='button' class='btn text-primary p-0 ml-2' id="update-{{link.pk}}" data-what='link' hx-get='{% url "fragment:update_fragment_link" link.pk %}' hx-trigger="click" hx-target="#link-{{link.pk}}" hx-swap="outerHTML"><i title='Edit this link' data-placement="top" data-toggle='tooltip' class='fa fa-solid fa-pen-nib fa-s '></i></button>
        </div>
        </form>

                {% if linked_field == 'fragment' %}
                {#TODO: update removal so antiquarian not removed and fields set to unknown#}
                <form novalidate class='form-inline' action='{% url "fragment:remove_fragment_link" link.pk %}' method='POST'>
                {% else %}
                <form novalidate class='form-inline' action='{% url "testimonium:remove_testimonium_link" link.pk %}' method='POST'>
                {% endif %}
                    {% csrf_token %}
                    <div class='form-group'>
                        {# TODO:why doesn't confirm-delete work?#}
                        <button type='submit' class='btn btn-link text-danger confirm-delete p-0 ml-2'
                            data-what='link'><i title='Remove this link' data-placement="top" data-toggle='tooltip' class='fa fa-solid fa-trash fa-s confirm-delete '></i></button>
                    </div>
                </form>
        {% endif %}
        </div>
    </div>
    {% endwith %}
