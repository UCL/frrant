{% extends "research/detail_base.html" %}
{% load i18n object_lock %}

{% block heading %}{{ object.name }}{% endblock %}


{% block action %}

    {% with request.user|has_lock:object as has_object_lock %}

        {% include 'research/partials/render_locked_info.html' %}

        <div class='d-flex justify-content-end'>
            {% if has_object_lock %}
                {% if perms.research.delete_antiquarian %}
                    <form novalidate class='form-inline' action='{% url "antiquarian:delete" antiquarian.pk %}' method='POST'>
                        {% csrf_token %}
                        <div class='form-group'>
                            <button type='submit' class='btn btn-link text-danger confirm-delete p-0 ml-2'
                                data-what='antiquarian'>{% trans 'Delete' %}</button>
                        </div>
                    </form>
                {% endif %}
            {% endif %}
        </div>
    {% endwith %}

{% endblock %}

{% block inner %}

    {% with request.user|has_lock:object as has_object_lock %}

    <hr>
    <section>
        <div class='d-flex justify-content-between mb-3'>
            <div>
                <h5>{% trans 'Details' %}</h5>
            </div>
            <div>
                {% if perms.research.change_antiquarian and has_object_lock %}
                <a href='{% url "antiquarian:update" object.pk %}'>{% trans 'Edit' %}</a>
                {% endif %}
            </div>
        </div>

        <dl class="row mb-0">
            <dt class="col-sm-3">{% trans 'Name' %}</dt>
            <dd class="col-sm-9">{{ object.name }}</dd>
        
            <dt class="col-sm-3">{% trans 'RE Number' %}</dt>
            <dd class="col-sm-9">{{ object.re_code }}</dd>
            
            <dt class="col-sm-3">{% trans 'Relevant Dates' %}</dt>
            <dd class="col-sm-9">
                {{ object.display_date_range|default:'-' }}
            </dd>

            <dt class="col-sm-3">{% trans 'Biography' %}</dt>
            <dd class="col-sm-9">
                {{ object.biography.content|linebreaks }}

                {% comment %}

                {% if perms.research.view_comment %}
                <br>
                {{ object.biography.comments.count }} comments <a href='{% url "list_comments_on_text" object.biography.pk %}'>view</a>
                {% endif %}

                {% endcomment %}
            </dd>
            <p>
                
            </p>

        </dl>
    </section>

    <hr>

    <section>

        <div class='d-flex justify-content-between mb-3'>
            <div>
                <h5>{% trans 'Works' %}</h5>
            </div>
            <div>
                {% if perms.research.change_antiquarian and has_object_lock %}
                    {% if perms.research.add_work %}
                    <a href='{% url "antiquarian:create_work" object.pk %}'>{% trans 'Add' %}</a> |
                    {% endif %}
                <a href='{% url "antiquarian:update_works" object.pk %}'>{% trans 'Edit' %}</a>
                {% endif %}
            </div>
        </div>

        {% for work in object.works.all %}

        {% include 'research/partials/work_list_item.html' with work=work %}
        
        {% endfor %}
    </section>


    <hr>

    <section>
        <div class='d-flex justify-content-between mb-3'>
            <div>
                <h5>{% trans 'Ordered Testimonia' %}</h5>
            </div>
            <div>
                {% if perms.research.change_antiquarian and has_object_lock %}
                <a href='{% url "testimonium:create" %}'>{% trans 'Add' %}</a>
                {% endif %}
            </div>
        </div>

        {% for link in object.testimoniumlinks.all %}

        {% include 'research/partials/testimonium_link_list_item.html' with link=link testimonium=link.linked can_edit=perms.research.change_antiquarian has_object_lock=has_object_lock %}

        {% endfor %}

    </section>


    <hr>

    <section>
        <div class='d-flex justify-content-between mb-3'>
            <div>
                <h5>{% trans 'Ordered Fragments' %}</h5>
            </div>
            <div>
                {% if perms.research.change_antiquarian and has_object_lock %}
                <a href='{% url "fragment:create" %}'>{% trans 'Add' %}</a>
                {% endif %}
            </div>
        </div>

        {% for link in object.fragmentlinks.all %}

        {% include 'research/partials/fragment_link_list_item.html' with link=link fragment=link.linked can_edit=perms.research.change_antiquarian has_object_lock=has_object_lock %}

        {% endfor %}
    </section>



    <hr>

    <section>
        <div class='d-flex justify-content-between mb-3'>
            <div>
                <h5>{% trans 'Bibliography' %}</h5>
            </div>
            <div>
                {% if perms.research.change_antiquarian and has_object_lock %}
                <a href='{% url "antiquarian:create_bibliography" object.pk %}'>{% trans 'Add' %}</a>
                {% endif %}
            </div>
        </div>
        {% for item in object.bibliography_items.all %}

        {% include 'research/partials/bibliography_list_item.html' with can_edit=perms.research.change_antiquarian has_object_lock=has_object_lock %}

        {% endfor %}
    </section>

    {% endwith %}

{% endblock %}

