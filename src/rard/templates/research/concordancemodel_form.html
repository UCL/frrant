{% extends "research/base.html" %}
{% load i18n bootstrap4 %}
{% block title %}
    {% if object %}
        {% trans 'Update Concordance for Original Text ' %}{{original_text.pk}}
    {% else %}
        {% trans 'Create Concordance for Original Text ' %}{{original_text.pk}}
    {% endif %}
{% endblock %}

{% block heading %}
    {% if object %}
        {% trans 'Update Concordance' %}
    {% else %}
        {% trans 'Create Concordance' %}
    {% endif %}
{% endblock %}

{% block inner %}
    <label>For original text:</label>

        <div>
            {% include 'research/partials/original_text_preview.html' with original_text=original_text %}
        </div>
{% if original_text.concordances.count != 0 %}
<div>
    This original text has some existing concordances in the old format:
    <div>
    {% for c in original_text.concordances.all %}
    {{c}} |
    {% endfor %}
    </div>
</div>
<br>
{% endif %}
<div class="concordance-form__area">

{% if edition_form %}
<form novalidate enctype="multipart/form-data" autocomplete='off' action='{{ request.path }}' class="form" method='POST' id="edition_form">
    {% csrf_token %}

    <div class="d-flex flex-column justify-content-between edition-select">
    {% bootstrap_field edition_form.edition %}
    <h2 class="alphabetum btn-link new-edition-btn">Or create a new Edition >></h2>
    </div>

    <div class="d-flex flex-column new-edition invisible justify-content-between">
        <div class="d-flex flex-row">
        {% bootstrap_field edition_form.new_edition %}
        {% bootstrap_field edition_form.new_description %}
        </div>
        <div>
            {% bootstrap_field edition_form.part_format %}
            <input type="hidden" name="original_text" value={{original_text.pk}}>
        </div>
        <h2 class="alphabetum btn-link select-edition-btn">Or select Edition >></h2>
    </div>
    <br>
    <script>
        document.querySelector(".new-edition-btn").onclick = ()=>{
            document.querySelector(".edition-select").classList.add("invisible");
            document.querySelector(".new-edition").classList.remove("invisible");
    };
    document.querySelector(".select-edition-btn").onclick = ()=>{
        document.querySelector(".edition-select").classList.remove("invisible");
        document.querySelector(".new-edition").classList.add("invisible");
}

    </script>
<button type="button" class="btn btn-primary" hx-post="{% url 'concordance:edition_select' %}" hx-target="#edition_form" hx-trigger="click" hx-swap="outerHTML">{% trans 'Next' %}</button>
</form>

{% endif %}

{% if concordance_form %}
    {% include 'research/partials/concordance_form_section.html' %}

{% endif %}

<button type="button" class="btn btn-outline-secondary mt-1 concordance-cancel" onclick="window.location.href='{{original_text.owner.get_absolute_url}}'">{% trans 'Cancel' %}</button>

</div>


{% endblock %}
